{"version":3,"file":"public_js_search_js.bundle.js","mappings":";;;;;;;;;;;;;;;;;;;AAAA;AACmD;AAC4C;AACnB;AACjC;AAC3C;AACA,CAAC;AACD,QAAQ,CAAC;AACT,QAAQ,CAAC;AACT,QAAQ,CAAC;AACT,QAAQ,CAAC;AACT,QAAQ,CAAC;AACT,4DAA4D;AAC5D,QAAQ,CAAC;AACT;AACA;AACA,QAAQ,CAAC,2BAA2B,CAAC;AACrC,QAAQ,CAAC;AACT,QAAQ,CAAC;AACT,QAAQ,CAAC;AACT;AACA;AACA,CAAC;AACD;AACA;AACA,IAAI,CAAC;AACL,IAAI,CAAC;AACL;AACA;AACA,IAAI,CAAC;AACL,IAAI,CAAC;AACL;AACA;AACA;AACO;AACP;AACA,IAAI,CAAC;AACL;AACA,gBAAgB,CAAC;AACjB,gBAAgB,CAAC;AACjB,gBAAgB,CAAC;AACjB,gBAAgB,CAAC;AACjB,gBAAgB,CAAC;AACjB,cAAc;AACd,gBAAgB,CAAC;AACjB,gBAAgB,CAAC;AACjB,gBAAgB,CAAC;AACjB,gBAAgB,CAAC;AACjB;AACA;AACA,KAAK;AACL;AACA,IAAI,CAAC;AACL;AACA,KAAK;AACL;AACA,IAAI,CAAC;AACL;AACA,KAAK;AACL;AACA,IAAI,CAAC;AACL;AACA;AACA;AACA,KAAK;AACL;AACA,IAAI,CAAC;AACL;AACA,KAAK;AACL;AACA,uBAAuB,qDAAY;AACnC;AACA,IAAI,CAAC;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,+CAAM;AACd;AACA,SAAS;AACT,MAAM;AACN;AACA;AACA;AACA,IAAI,CAAC;AACL;AACA,KAAK;AACL;AACA;AACA;AACA,sBAAsB,CAAC;AACvB,IAAI,oDAAW;AACf;AACA,IAAI,+CAAM;AACV;AACA,KAAK;AACL;AACA;AACA;AACA,IAAI,sDAAe;AACnB;AACA,QAAQ,kDAAY,IAAI,yDAAmB,QAAQ,sDAAgB;AACnE;AACA,mBAAmB,yDAAmB;AACtC,YAAY,kDAAY,CAAC,yDAAmB;AAC5C;AACA;AACA;AACA,aAAa,kDAAY;AACzB;AACA;AACA;AACA;AACA,wBAAwB,QAAQ;AAChC,oDAAoD,kDAAY;AAChE,+CAA+C,kDAAY,kCAAkC,kDAAY;AACzG;AACA,cAAc;AACd;AACA,wCAAwC,kDAAY;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,CAAC;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA,QAAQ,mDAAa;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,mDAAa;AAC7B;AACA;AACA;AACA;AACA;AACA,oCAAoC,QAAQ;AAC5C;AACA;AACA;AACA,0BAA0B;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,CAAC;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA,IAAI,CAAC;AACL;AACA;AACA;AACA,QAAQ,CAAC;AACT;AACA,oBAAoB,+BAA+B;AACnD,QAAQ,CAAC,yCAAyC,qDAAY;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,CAAC;AACL,IAAI,CAAC;AACL;AACA;AACA,oBAAoB,+BAA+B;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,sCAAsC;AAC1D;AACA;AACA;AACA;AACA;AACA,YAAY,CAAC;AACb,UAAU;AACV;AACA;AACA;AACA,YAAY,CAAC;AACb,YAAY,CAAC;AACb,gBAAgB,CAAC;AACjB,gCAAgC,sCAAsC;AACtE;AACA;AACA;AACA;AACA,oBAAoB,CAAC;AACrB;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,oBAAoB,+BAA+B;AACnD,wBAAwB,2CAA2C;AACnE;AACA;AACA;AACA;AACA;AACA,oBAAoB,uCAAuC;AAC3D;AACA;AACA;AACA;AACA;AACA,YAAY,CAAC;AACb,UAAU;AACV;AACA;AACA;AACA,YAAY,CAAC;AACb,YAAY,CAAC;AACb,gBAAgB,CAAC;AACjB,gCAAgC,uCAAuC;AACvE;AACA;AACA;AACA;AACA,oBAAoB,CAAC;AACrB;AACA,aAAa;AACb;AACA;AACA;AACA;AACO;AACP,iCAAiC,qDAAY;AAC7C;AACA;AACA,QAAQ,+CAAQ;AAChB;AACA;AACA;AACA,IAAI,2DAAkB;AACtB;AACA;AACA,YAAY,+CAAQ;AACpB;AACA;AACA,QAAQ,sDAAe;AACvB;AACA;AACA,YAAY,CAAC;AACb,UAAU;AACV,YAAY,CAAC;AACb;AACA;AACA,QAAQ,CAAC;AACT;AACA,YAAY,CAAC;AACb,YAAY,CAAC;AACb,UAAU;AACV,YAAY,CAAC;AACb,YAAY,CAAC;AACb;AACA,aAAa;AACb;AACA,QAAQ,CAAC;AACT;AACA,YAAY,CAAC;AACb;AACA;AACA;AACA;AACA,UAAU;AACV;AACA,UAAU;AACV;AACA;AACA;AACA;AACA,QAAQ,CAAC;AACT;AACA;AACA;AACA,UAAU;AACV;AACA,UAAU;AACV;AACA,UAAU;AACV;AACA;AACA,QAAQ,CAAC;AACT;AACA,wBAAwB,OAAO;AAC/B;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA,kBAAkB;AAClB;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA,QAAQ,CAAC;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,QAAQ,CAAC;AACT;AACA;AACA;AACA,gBAAgB,CAAC;AACjB,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,CAAC;AACjB,cAAc;AACd,gBAAgB,CAAC;AACjB;AACA,UAAU;AACV,YAAY,CAAC;AACb;AACA;AACA,YAAY,CAAC;AACb,UAAU;AACV,YAAY,CAAC;AACb;AACA;AACA;AACA,QAAQ,CAAC;AACT,QAAQ,CAAC;AACT;AACA,YAAY,CAAC;AACb,YAAY,CAAC;AACb;AACA;AACA,YAAY,CAAC;AACb;AACA;AACA;AACA,aAAa;AACb,YAAY,CAAC;AACb,UAAU;AACV;AACA,gBAAgB,CAAC;AACjB,cAAc;AACd,gBAAgB,CAAC;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,YAAY,CAAC;AACb;AACA,gBAAgB,CAAC;AACjB;AACA,UAAU;AACV,YAAY,CAAC;AACb,YAAY,CAAC;AACb;AACA;AACA,YAAY,CAAC;AACb,YAAY,CAAC;AACb,UAAU;AACV,YAAY,CAAC;AACb;AACA;AACA,wBAAwB,gCAAgC;AACxD;AACA;AACA;AACA;AACA;AACA,QAAQ,CAAC;AACT,QAAQ,CAAC;AACT,KAAK;AACL;AACA;AACA,QAAQ,+CAAQ;AAChB;AACA,KAAK;AACL;AACA;AACA;AACA,IAAI,CAAC;AACL;AACA,KAAK;AACL;AACA,IAAI,CAAC;AACL;AACA,KAAK;AACL;AACA,IAAI,CAAC;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,CAAC;AACL,IAAI,CAAC;AACL,eAAe,gEAAa;AAC5B,IAAI,CAAC;AACL,IAAI,CAAC;AACL;AACA;AACA;AACA,IAAI,CAAC;AACL;AACA;AACA;AACA,eAAe,gEAAa;AAC5B,IAAI,CAAC;AACL,IAAI,CAAC;AACL,IAAI,CAAC,wCAAwC,CAAC,qCAAqC;AACnF,IAAI,CAAC;AACL,wBAAwB,CAAC;AACzB,IAAI,CAAC;AACL,IAAI,CAAC;AACL;AACA,YAAY,CAAC;AACb,gBAAgB,CAAC;AACjB,gBAAgB,CAAC;AACjB,gBAAgB,CAAC,4CAA4C,CAAC,yCAAyC;AACvG,gBAAgB,CAAC;AACjB,gBAAgB,CAAC;AACjB,gBAAgB,CAAC;AACjB;AACA,wBAAwB,CAAC;AACzB;AACA,4BAA4B,CAAC;AAC7B;AACA,2CAA2C,mDAAa;AACxD;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA,8BAA8B;AAC9B;AACA;AACA;AACA;AACA;AACA,4BAA4B,mDAAa;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC;AACzC,qCAAqC;AACrC,iCAAiC;AACjC,4BAA4B,uDAAiB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD,mDAAa;AACpE,mDAAmD,2FAAwC;AAC3F;AACA;AACA;AACA;AACA,yCAAyC;AACzC,qCAAqC;AACrC,iCAAiC;AACjC,6BAA6B;AAC7B;AACA,gCAAgC,+CAAQ;AACxC,6BAA6B;AAC7B;AACA;AACA,iBAAiB;AACjB,cAAc;AACd;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,oBAAoB,IAAI,CAAC,0BAA0B;AACnD,qBAAqB,CAAC;AACtB;AACA,wBAAwB,IAAI,CAAC,kDAAkD;AAC/E,gBAAgB,CAAC;AACjB,6CAA6C,CAAC;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,IAAI,wDAAkB,mBAAmB;AACnF,wBAAwB,oBAAoB;AAC5C;AACA,4BAA4B,qBAAqB;AACjD;AACA,uCAAuC,iDAAW;AAClD;AACA;AACA,kBAAkB;AAClB,wBAAwB,iDAAW;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,iDAAW;AACpC;AACA;AACA;AACA;AACA;AACA","sources":["webpack://sc-library/./public/js/search.js"],"sourcesContent":["// Make content Responsive\r\nimport { changePageTitle, goToPage } from './ajax';\r\nimport { buildBookBox, findURLValue, getBookFromBarcode, search, setURLValue } from './common';\r\nimport { bookDatabase, db, searchCache, timeLastSearched } from './globals';\r\nimport firebase from 'firebase/compat/app';\r\n// Doesn't have to be setup because the window element doesn't change.\r\n$(window).on(\"resize\", () => {\r\n    if ($(window).width() > 786) {\r\n        $('#sort-container').width('fit-content');\r\n        $('.sort-section').show();\r\n        $('.sort-section').css('opacity', '1');\r\n        $('#close-button').hide();\r\n        // $('#sort-sidebar').css('overflow-y', 'visible'); Was causing problems, if needed, reimplement\r\n        $('#sort-sidebar').css('max-height', '');\r\n\r\n    }\r\n    if ($(window).width() <= 786 && $('#close-button').css('display') == 'none') {\r\n        $('#sort-container').width('0');\r\n        $('.sort-section').hide();\r\n        $('.sort-section').css('opacity', '0');\r\n\r\n    }\r\n});\r\n\r\n// Set Initial window layout.\r\nif ($(window).width() > 786) {\r\n    $('.sort-section').show();\r\n\r\n}\r\nif ($(window).width() <= 786) {\r\n    $('.sort-section').hide();\r\n\r\n}\r\n\r\nexport function setupSearch(searchResultsArray, pageQuery) {\r\n    // Create Sort Dropdown Event Listener\r\n    $('#sort-main-title').on(\"click\", () => {\r\n        if (window.innerWidth < 787) {\r\n            if ($('.sort-section').css('display') == 'none') {\r\n                $('.sort-section').show(0).delay(10);\r\n                $('#sort-sidebar').css('max-height', '500px');\r\n                $('#sort-sidebar').css('overflow-y', 'scroll');\r\n                $('.sort-section').css('opacity', '1');\r\n            } else {\r\n                $('.sort-section').delay(1000).hide(0);\r\n                $('#sort-sidebar').css('overflow-y', 'hidden');\r\n                $('#sort-sidebar').css('max-height', '58px');\r\n                $('.sort-section').css('opacity', '0');\r\n            }\r\n        }\r\n    });\r\n\r\n    $('#author-show-more').on(\"click\", () => {\r\n        alert(\"Add Functionality\");\r\n    });\r\n\r\n    $('#subject-show-more').on(\"click\", () => {\r\n        alert(\"Add Functionality\");\r\n    });\r\n\r\n    $(\"#search-page-input\").on(\"keydown\", (event) => {\r\n        if (event.key === \"Enter\") {\r\n            searchPageSearch();\r\n        }\r\n    });\r\n\r\n    $(\"#search-page-search-button\").on(\"click\", () => {\r\n        searchPageSearch();\r\n    });\r\n\r\n    var queryFromURL = findURLValue(pageQuery, \"query\", true);\r\n\r\n    $(\"#search-page-input\").val(queryFromURL);\r\n\r\n    if (searchResultsArray == null) {\r\n        // If you are entering the page without a search completed\r\n        if (queryFromURL == \"\") {\r\n            browse();\r\n            return;\r\n        }\r\n        search(queryFromURL).then((resultsArray) => {\r\n            createSearchResultsPage(resultsArray);\r\n        });\r\n    } else {\r\n        createSearchResultsPage(searchResultsArray);\r\n    }\r\n\r\n    $(\"#apply-search-filters\").on(\"click\", () => {\r\n        applySearchFilters();\r\n    });\r\n}\r\n\r\nfunction searchPageSearch() {\r\n    var searchQuery = $('#search-page-input').val();\r\n    setURLValue(\"query\", searchQuery);\r\n\r\n    search(searchQuery).then((searchResultsArray) => {\r\n        createSearchResultsPage(searchResultsArray);\r\n    });\r\n}\r\n\r\nfunction browse() {\r\n    changePageTitle(\"Browse\", false);\r\n    var browseResultsArray = [];\r\n    if (bookDatabase && bookDatabase.length > 0 && timeLastSearched != null) {\r\n        // At this point, we can assume that the book database has been loaded from a search, so just use that for browsing.\r\n        var docs = bookDatabase.length - 1;\r\n        if (bookDatabase[bookDatabase.length - 1].books.length < 25 && docs != 0) {\r\n            docs--;\r\n        }\r\n        var rand = Math.floor(Math.random() * docs);\r\n        if (!bookDatabase[rand]) {\r\n            console.error(\"books \" + rand + \" does not exist in the local book database\");\r\n            return;\r\n        }\r\n        var values = [], count = 0;\r\n        for (let i = 0; i < 20; i++) {\r\n            var random = Math.floor(Math.random() * bookDatabase[rand].books.length);\r\n            if (values.indexOf(random) > -1 || bookDatabase[rand].books[random].isDeleted || bookDatabase[rand].books[random].isHidden) {\r\n                i--;\r\n            } else {\r\n                values.push(random);\r\n                browseResultsArray.push(bookDatabase[rand].books[random]);\r\n            }\r\n            count++;\r\n            if (count > 10000) {\r\n                if (i > 0) {\r\n                    console.error(\"no books available\");\r\n                    const p = document.createElement('p');\r\n                    p.appendChild(document.createTextNode(\"Sorry, we were not able to process your query at this time. Please try again later.\"));\r\n                    $('div#results-container')[0].appendChild(p);\r\n\r\n                }\r\n                createSearchResultsPage(browseResultsArray);\r\n                return;\r\n            }\r\n        }\r\n        createSearchResultsPage(browseResultsArray);\r\n    } else {\r\n        // No search has been performed on the page yet, so get it from the database.\r\n        db.collection(\"books\").where(\"order\", \">=\", 0).orderBy(\"order\", \"desc\").limit(1).get().then((querySnapshot) => {\r\n            querySnapshot.forEach((doc) => {\r\n                if (!doc.exists()) {\r\n                    console.error(\"books document does not exist\");\r\n                    return;\r\n                }\r\n                var docs = doc.data().order;\r\n                if (doc.data().books.length < 25 && docs != 0) {\r\n                    docs--;\r\n                }\r\n                var rand = Math.floor(Math.random() * docs);\r\n                rand = \"0\" + rand;\r\n                if (rand.length == 2) rand = \"0\" + rand;\r\n                db.collection(\"books\").doc(rand).get().then((doc) => {\r\n                    if (!doc.exists()) {\r\n                        console.error(\"books \" + rand + \" does not exist\");\r\n                        return;\r\n                    }\r\n                    var values = [], count = 0;\r\n                    for (let i = 0; i < 20; i++) {\r\n                        var random = Math.floor(Math.random() * doc.data().books.length);\r\n                        if (values.indexOf(random) > -1 || doc.data().books[random].isDeleted || doc.data().books[random].isHidden) {\r\n                            i--;\r\n                        } else {\r\n                            values.push(random);\r\n                            browseResultsArray.push(doc.data().books[random]);\r\n                        }\r\n                        count++;\r\n                        if (count > 10000) {\r\n                            if (i > 0) {\r\n                                console.error(\"no books available\");\r\n                                const p = document.createElement('p');\r\n                                p.appendChild(document.createTextNode(\"Sorry, we were not able to process your query at this time. Please try again later.\"));\r\n                                $('div#results-container')[0].appendChild(p);\r\n\r\n                            }\r\n                            createSearchResultsPage(browseResultsArray);\r\n                            return;\r\n                        }\r\n                    }\r\n                    createSearchResultsPage(browseResultsArray);\r\n                });\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\nfunction createSearchResultsPage(searchResultsArray) {\r\n    $('div#results-container').empty();\r\n    if (searchResultsArray.length == 0) {\r\n        const p = document.createElement('p');\r\n        p.appendChild(document.createTextNode(\"That search returned no results. Please try again.\"));\r\n        $('div#results-container')[0].appendChild(p);\r\n    }\r\n    for (let i = 0; i < searchResultsArray.length; i++) {\r\n        $('div#results-container')[0].appendChild(buildBookBox(searchResultsArray[i], \"search\", i + 1));\r\n    }\r\n    createFilterList(searchResultsArray);\r\n}\r\n\r\nvar searchResultsAuthorsArray = [];\r\nvar searchResultsSubjectsArray = [];\r\nfunction createFilterList(searchResultsArray) {\r\n    // TODO: This function should also order each of the lists by occurances.\r\n    searchResultsAuthorsArray = [];\r\n    searchResultsSubjectsArray = [];\r\n    $(\"#sort-author-list\").empty();\r\n    $(\"#sort-subject-list\").empty();\r\n\r\n    // Authors\r\n    for (let i = 0; i < searchResultsArray.length; i++) {\r\n        if (!searchResultsAuthorsArray.includes(searchResultsArray[i].authors[0]) && searchResultsArray[i].authors[0]) {\r\n            searchResultsAuthorsArray.push(searchResultsArray[i].authors[0]);\r\n        }\r\n        if (!searchResultsAuthorsArray.includes(searchResultsArray[i].authors[1]) && searchResultsArray[i].authors[1]) {\r\n            searchResultsAuthorsArray.push(searchResultsArray[i].authors[1]);\r\n        }\r\n    }\r\n    for (let i = 0; i < searchResultsAuthorsArray.length; i++) {\r\n        let authorArray = searchResultsAuthorsArray[i];\r\n        const li = document.createElement(\"li\");\r\n        li.classList.add(\"sort-item\");\r\n        li.innerHTML = \"<input type=\\\"checkbox\\\">\" + authorArray.last + \", \" + authorArray.first;\r\n        if (i < 6) {\r\n            $(\"#sort-author-list\")[0].appendChild(li);\r\n        } else if (i == 6) {\r\n            const span = document.createElement(\"span\");\r\n            span.id = \"author-show-more\";\r\n            span.innerHTML = \"Show More...\";\r\n            $(\"#sort-author-list\")[0].appendChild(span);\r\n            $(\"#author-show-more\").on(\"click\", () => {\r\n                $(\"#author-show-more\").css(\"display\", \"none\");\r\n                for (let j = 6; j < searchResultsAuthorsArray.length; j++) {\r\n                    let authorArray = searchResultsAuthorsArray[j];\r\n                    const li = document.createElement(\"li\");\r\n                    li.classList.add(\"sort-item\");\r\n                    li.innerHTML = \"<input type=\\\"checkbox\\\">\" + authorArray.last + \", \" + authorArray.first;\r\n                    $(\"#sort-author-list\")[0].appendChild(li);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    // Subjects\r\n    for (let i = 0; i < searchResultsArray.length; i++) {\r\n        for (let j = 0; j < searchResultsArray[i].subjects.length; j++) {\r\n            if (!searchResultsSubjectsArray.includes(searchResultsArray[i].subjects[j]) && searchResultsArray[i].subjects[j]) {\r\n                searchResultsSubjectsArray.push(searchResultsArray[i].subjects[j]);\r\n            }\r\n        }\r\n    }\r\n    for (let i = 0; i < searchResultsSubjectsArray.length; i++) {\r\n        let subject = searchResultsSubjectsArray[i];\r\n        const li = document.createElement(\"li\");\r\n        li.classList.add(\"sort-item\");\r\n        li.innerHTML = \"<input type=\\\"checkbox\\\">\" + subject;\r\n        if (i < 6) {\r\n            $(\"#sort-subject-list\")[0].appendChild(li);\r\n        } else if (i == 6) {\r\n            const span = document.createElement(\"span\");\r\n            span.id = \"subject-show-more\";\r\n            span.innerHTML = \"Show More...\";\r\n            $(\"#sort-subject-list\")[0].appendChild(span);\r\n            $(\"#subject-show-more\").on(\"click\", () => {\r\n                $(\"#subject-show-more\").css(\"display\", \"none\");\r\n                for (let j = 6; j < searchResultsSubjectsArray.length; j++) {\r\n                    let subject = searchResultsSubjectsArray[j];\r\n                    const li = document.createElement(\"li\");\r\n                    li.classList.add(\"sort-item\");\r\n                    li.innerHTML = \"<input type=\\\"checkbox\\\">\" + subject;\r\n                    $(\"#sort-subject-list\")[0].appendChild(li);\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\nexport function setupResultPage(pageQuery) {\r\n    var barcodeNumber = parseInt(findURLValue(pageQuery, \"id\"));\r\n    if (!barcodeNumber) {\r\n        alert(\"Error: A valid barcode was not provided.\");\r\n        goToPage(\"\");\r\n        return;\r\n    }\r\n\r\n    getBookFromBarcode(barcodeNumber).then((bookObject) => {\r\n        if (!bookObject || bookObject.isDeleted || bookObject.isHidden) {\r\n            alert(\"Error: No information could be found for that book.\");\r\n            goToPage(\"\");\r\n            return;\r\n        }\r\n        changePageTitle(bookObject.title);\r\n\r\n        if (bookObject.medium == \"av\") {\r\n            $(\"#result-page-image\").attr(\"src\", \"../img/av-image.jpg\");\r\n        } else {\r\n            $(\"#result-page-image\").attr(\"src\", bookObject.coverImageLink);\r\n        }\r\n\r\n        $(\"#result-page-barcode-number\").html(barcodeNumber);\r\n        if (!bookObject.canBeCheckedOut) {\r\n            $(\"#checkout-button\").hide();\r\n            $(\"#result-page-image\").after(\"Unfortuantely, this book cannot be checked out.\");\r\n        } else {\r\n            $(\"#checkout-button\").show();\r\n            $(\"#checkout-button\").on(\"click\", () => {\r\n                checkout(barcodeNumber);\r\n            });\r\n        }\r\n        $(\"#result-page-isbn-number\").html(\"ISBN 10: \" + bookObject.isbn10 + \"<br>ISBN 13: \" + bookObject.isbn13);\r\n        if (bookObject.isbn10 == \"\" && bookObject.isbn13 == \"\") {\r\n            $(\"#result-page-isbn-number\").html(\"None\");\r\n        }\r\n        var callNumberAnswer = \"\";\r\n        if (bookObject.audience[0] == true) {\r\n            callNumberAnswer += \"J\";\r\n        } else if (bookObject.audience[1] == true) {\r\n            callNumberAnswer += \"Y\";\r\n        } else if (bookObject.canBeCheckedOut == false) {\r\n            callNumberAnswer += \"REF<br>\";\r\n        }\r\n        callNumberAnswer += bookObject.ddc;\r\n        callNumberAnswer += \"<br>\" + bookObject.authors[0].last.toUpperCase().substring(0, 3);\r\n        $(\"#result-page-call-number\").html(callNumberAnswer);\r\n        var mediumAnswer = \"\";\r\n        if (bookObject.medium == \"paperback\") {\r\n            mediumAnswer = \"Paperback\";\r\n        } else if (bookObject.medium == \"hardcover\") {\r\n            mediumAnswer = \"Hardcover\";\r\n        } else if (bookObject.medium == \"av\") {\r\n            mediumAnswer = \"AV\";\r\n        } else {\r\n            console.warn(\"There is a case that is not covered for: \" + bookObject.medium);\r\n        }\r\n        $(\"#result-page-medium\").html(mediumAnswer);\r\n        var audienceAnswer = \"\";\r\n        for (let i = 0; i < 4; i++) {\r\n            var temp = bookObject.audience[i];\r\n            if (temp) {\r\n                if (i == 0) {\r\n                    audienceAnswer += \"Children, \";\r\n                } else if (i == 1) {\r\n                    audienceAnswer += \"Youth, \";\r\n                } else if (i == 2) {\r\n                    audienceAnswer += \"Adult, \";\r\n                } else if (i == 3) {\r\n                    audienceAnswer += \"None, \";\r\n                }\r\n            }\r\n        }\r\n        audienceAnswer = audienceAnswer.substring(0, audienceAnswer.lastIndexOf(\",\"));\r\n        $(\"#result-page-audience\").html(audienceAnswer);\r\n        var publishersAnswer = \"\";\r\n        bookObject.publishers.forEach((item) => {\r\n            publishersAnswer += (item + \", \");\r\n        });\r\n        publishersAnswer = publishersAnswer.substring(0, publishersAnswer.lastIndexOf(\",\"));\r\n        if (publishersAnswer == \"\") publishersAnswer = \"None\";\r\n        $(\"#result-page-publisher\").html(publishersAnswer);\r\n        if (bookObject.publishDate) {\r\n            var d = bookObject.publishDate.toDate();\r\n            if (d.getMonth() != 0 && d.getDate() != 1) {\r\n                $(\"#result-page-publish-date\").html(d.getMonth() + 1 + \"/\" + d.getDate() + \"/\" + d.getFullYear());\r\n            } else if (d.getMonth() != 0) {\r\n                var month;\r\n                switch (d.getMonth()) {\r\n                    case 0:\r\n                        month = \"Jan\";\r\n                        break;\r\n                    case 1:\r\n                        month = \"Feb\";\r\n                        break;\r\n                    case 2:\r\n                        month = \"Mar\";\r\n                        break;\r\n                    case 3:\r\n                        month = \"Apr\";\r\n                        break;\r\n                    case 4:\r\n                        month = \"May\";\r\n                        break;\r\n                    case 5:\r\n                        month = \"Jun\";\r\n                        break;\r\n                    case 6:\r\n                        month = \"Jul\";\r\n                        break;\r\n                    case 7:\r\n                        month = \"Aug\";\r\n                        break;\r\n                    case 8:\r\n                        month = \"Sep\";\r\n                        break;\r\n                    case 9:\r\n                        month = \"Oct\";\r\n                        break;\r\n                    case 10:\r\n                        month = \"Nov\";\r\n                        break;\r\n                    case 11:\r\n                        month = \"Dec\";\r\n                        break;\r\n\r\n                    default:\r\n                        console.error(\"The month could not be detected\");\r\n                        month = \"\";\r\n                        break;\r\n                }\r\n                $(\"#result-page-publish-date\").html(month + \", \" + d.getFullYear());\r\n            } else {\r\n                $(\"#result-page-publish-date\").html(d.getFullYear());\r\n            }\r\n        } else {\r\n            $(\"#result-page-publish-date\").html(\"None\");\r\n        }\r\n        if (bookObject.numberOfPages > 0) {\r\n            $(\"#result-page-pages\").html(bookObject.numberOfPages);\r\n        } else {\r\n            $(\"#result-page-pages\").html(\"Unnumbered\");\r\n        }\r\n\r\n\r\n        $(\"#result-page-title\").html(bookObject.title);\r\n        $(\"#result-page-subtitle\").html(bookObject.subtitle);\r\n        if (bookObject.subtitle == null || bookObject.subtitle.length < 1) {\r\n            $(\"#result-page-subtitle-header\").hide();\r\n            $(\"#result-page-subtitle\").hide();\r\n        }\r\n        if (bookObject.authors.length > 1) {\r\n            $(\"#result-page-author-header\").html(\"Authors\");\r\n            var authorAnswer = \"\";\r\n            bookObject.authors.forEach((item) => {\r\n                authorAnswer += item.last + \", \" + item.first + \"<br>\";\r\n            });\r\n            $(\"#result-page-author\").html(authorAnswer);\r\n        } else {\r\n            if (bookObject.authors[0].first == \"\" && bookObject.authors[0].last == \"\") {\r\n                $(\"#result-page-author\").html(\"None\");\r\n            } else {\r\n                $(\"#result-page-author\").html(bookObject.authors[0].last + \", \" + bookObject.authors[0].first);\r\n            }\r\n        }\r\n        if (bookObject.illustrators.length > 0) {\r\n            var illustratorAnswer = \"\";\r\n            bookObject.illustrators.forEach((item) => {\r\n                illustratorAnswer += item.last + \", \" + item.first + \"<br>\";\r\n            });\r\n            $(\"#result-page-illustrator\").html(illustratorAnswer);\r\n            if (bookObject.illustrators.length > 1) {\r\n                $(\"#result-page-illustrator-header\").html(\"Illustrators\");\r\n            }\r\n        } else {\r\n            $(\"#result-page-illustrator-header\").hide();\r\n            $(\"#result-page-illustrator\").hide();\r\n        }\r\n        if (bookObject.subjects.length == 0) {\r\n            $(\"#result-page-subjects\").hide();\r\n            $(\"#result-page-subjects-header\").hide();\r\n        } else if (bookObject.subjects.length == 1) {\r\n            $(\"#result-page-subjects-header\").html(\"Subject\");\r\n        }\r\n        var subjectsAnswer = \"\";\r\n        for (let i = 0; i < bookObject.subjects.length; i++) {\r\n            subjectsAnswer += bookObject.subjects[i];\r\n            if (i != bookObject.subjects.length - 1) {\r\n                subjectsAnswer += \"<br>\";\r\n            }\r\n        }\r\n        $(\"#result-page-subjects\").html(subjectsAnswer);\r\n        $(\"#result-page-description\").html(bookObject.description);\r\n    }).catch((barcodeNumber) => {\r\n        alert(\"Error: No information could be found for that book.\");\r\n        alert(barcodeNumber + \" is not a valid barcode number.\");\r\n        goToPage(\"\");\r\n        return;\r\n    });\r\n\r\n    // Create Event Listeners\r\n\r\n    $(\"#checkout-button\").on(\"click\", () => {\r\n        checkout();\r\n    });\r\n\r\n    $(\"#checkout-next-button\").on(\"click\", () => {\r\n        scanCheckout();\r\n    });\r\n\r\n    $(\"#checkout-cancel-button\").on(\"click\", () => {\r\n        cancelCheckout();\r\n    });\r\n}\r\n\r\nfunction checkout(barcodeNumber) {\r\n    if (isNaN(barcodeNumber) || barcodeNumber.toString().indexOf(\"11711\") < 0) {\r\n        alert(\"There was an error checking out this book.\");\r\n        console.log(\"The barcode number could not be identified.\");\r\n        return;\r\n    }\r\n    $(\"#checkout-inner-popup-box\").html(\"<p>You are checking out this book as: <b><span id='checkout-name'></span></b>.<br>If this is not you, please click cancel and log out.</p>\");\r\n    $(\"#checkout-popup\").show();\r\n    var user = firebase.auth().currentUser;\r\n    $(\"#checkout-name\").html(user.email);\r\n    $(\"#checkout-next-button\").show();\r\n}\r\n\r\nfunction cancelCheckout() {\r\n    $(\"#checkout-popup\").hide();\r\n}\r\n\r\nfunction scanCheckout() {\r\n    var user = firebase.auth().currentUser;\r\n    $(\"#checkout-next-button\").hide();\r\n    $(\"#checkout-inner-popup-box\").html(\"<p>Please scan the barcode on the book now.</p>\");\r\n    $(\"#checkout-book-barcode\").blur(() => { $('#checkout-book-barcode').focus(); });\r\n    $(\"#checkout-book-barcode\").focus();\r\n    var barcodeNumber = $(\"#result-page-barcode-number\").html();\r\n    $(\"#checkout-book-barcode\").off(\"keydown\");\r\n    $(\"#checkout-book-barcode\").on(\"keydown\", (event) => {\r\n        if (event.key === \"Enter\") {\r\n            $(\"#checkout-book-barcode\").off(\"blur\");\r\n            if ($(\"#checkout-book-barcode\").val() == barcodeNumber) {\r\n                $(\"#checkout-inner-popup-box\").html(\"<p>Please scan the barcode on the checkout table now.</p>\");\r\n                $(\"#checkout-security-barcode\").blur(() => { $('#checkout-security-barcode').focus(); });\r\n                $(\"#checkout-security-barcode\").focus();\r\n                $(\"#checkout-security-barcode\").off(\"keydown\");\r\n                $(\"#checkout-security-barcode\").on(\"keydown\", (event) => {\r\n                    if (event.key === \"Enter\") {\r\n                        $(\"#checkout-security-barcode\").off(\"blur\");\r\n                        // TODO: Change to something else\r\n                        if ($(\"#checkout-security-barcode\").val() != \"\") {\r\n                            // At this point, they must have scanned both, so we check it out to them.\r\n                            var bookPath = db.collection(\"books\");\r\n                            var bookNumber = barcodeNumber - 1171100000;\r\n                            var bookDocument = Math.floor(bookNumber / 100);\r\n                            if (bookDocument >= 100) {\r\n                                bookDocument = \"\" + bookDocument;\r\n                            } else if (bookDocument >= 10) {\r\n                                bookDocument = \"0\" + bookDocument;\r\n                            } else {\r\n                                bookDocument = \"00\" + bookDocument;\r\n                            }\r\n                            bookNumber = bookNumber % 100;\r\n\r\n                            var d = new Date(2020);\r\n                            db.collection(\"users\").where(\"lastCheckoutTime\", \">\", d)\r\n                                .where(\"checkouts\", \"array-contains\", barcodeNumber)\r\n                                .orderBy(\"lastCheckoutTime\").limit(5).get().then((querySnapshot) => {\r\n                                    querySnapshot.forEach((doc) => {\r\n                                        doc.data().checkouts.forEach((checkoutObject) => {\r\n                                            if (checkoutObject.returnTime != null) {\r\n                                                alert(\"The book is already checked out to someone else. It must be returned first. Please put the book in the return area.\");\r\n                                                return;\r\n                                            }\r\n                                        });\r\n                                    });\r\n                                });\r\n                            db.runTransaction((transaction) => {\r\n                                return transaction.get(bookPath.doc(bookDocument)).then((doc) => {\r\n                                    if (!doc.exists()) {\r\n                                        alert(\"There was a problem with checking out that book.\");\r\n                                        return;\r\n                                    }\r\n\r\n                                    var bookObject = doc.data().books[bookNumber];\r\n                                    if (bookObject.canBeCheckedOut == false) {\r\n                                        alert(\"We're sorry, but this is a reference book, and it may not be checked out.\");\r\n                                        return;\r\n                                    }\r\n                                    var currentTime = Date.now();\r\n                                    // TODO: Rethink how this is all stored. Sub collection? Root collection?\r\n                                    transaction.update(db.collection(\"users\").doc(user.uid), {\r\n                                        checkouts: firebase.firestore.FieldValue.arrayUnion({\r\n                                            barcodeNumber: barcodeNumber,\r\n                                            outTime: currentTime,\r\n                                            inTime: null,\r\n                                            title: bookObject.title\r\n                                        })\r\n                                    });\r\n                                });\r\n                            }).then(() => {\r\n                                alert(\"This book has been checked out to you successfully.\");\r\n                                goToPage(\"\");\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                alert(\"This is not the right book. Please view the correct book's page before checking it out.\");\r\n                cancelCheckout();\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nfunction applySearchFilters() {\r\n    var filters = [], items = [], results = [];\r\n    for (let i = 0; i < $(\".sort-section\").length; i++) {\r\n        filters.push($(\".sort-section\")[i].children[0].innerHTML);\r\n        items.push([]);\r\n        for (let j = 0; j < $(\".sort-section\")[i].children[1].children.length; j++) {\r\n            if ($(\".sort-section\")[i].children[1].children[j].tagName == \"LI\") {\r\n                items[items.length - 1].push($(\".sort-section\")[i].children[1].children[j].children[0].checked);\r\n            }\r\n        }\r\n        if (items[items.length - 1].every((val, q, arr) => val === arr[0])) {\r\n            filters.pop();\r\n            items.pop();\r\n        }\r\n    }\r\n    for (let i = 0, passesFilters = true; i < searchCache.length && passesFilters; i++) {\r\n        for (let j = 0; j < filters.length; j++) {\r\n            var passesFilter = false;\r\n            for (let k = 0; k < items[j].length; k++) {\r\n                if (filters[j] == \"Audience\") {\r\n                    if (items[j][k] && searchCache[i].audience[k]) {\r\n                        passesFilter = true;\r\n                    }\r\n                } else if (filters[j] == \"Medium\") {\r\n                    if (searchCache[i].medium == items[j][k]) {\r\n                        // Justin, finish this\r\n                    }\r\n                }\r\n            }\r\n            if (!passesFilter)\r\n                passesFilters = false;\r\n        }\r\n        if (passesFilters) {\r\n            results.push(searchCache[i]);\r\n        }\r\n    }\r\n    createSearchResultsPage(results);\r\n}\r\n\r\nconsole.log(\"search.js Loaded!\");\r\n"],"names":[],"sourceRoot":""}